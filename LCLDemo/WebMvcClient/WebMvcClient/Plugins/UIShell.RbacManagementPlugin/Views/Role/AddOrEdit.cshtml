@{
    ViewBag.Title = "编辑角色";
}
@using LCL.MvcExtensions
@using UIShell.RbacPermissionService
@model AddOrEditViewModel<Role>
<style type="text/css">
    input {
        width: 200px;
    }
</style>
@using (Html.BeginForm(Model.Added ? "Add" : "Edit", "Role", FormMethod.Post, new { @class = "form-horizontal well", @role = "form" }))
{
    @Html.HiddenFor(c => c.CurrentPageNum)
    @Html.HiddenFor(c => c.PageSize)
    @Html.HiddenFor(c => c.Entity.ID)
    @Html.HiddenFor(c => c.Entity.RoleType)
    <table class="tb_searchbar">
        <tr>
            <td width="15%" class="td_title">@Html.LabelFor(c => c.Entity.Name):</td>
            <td>
                @Html.TextBoxFor(c => c.Entity.Name, new { @class = "easyui-validatebox", @placeholder = "请输入"})
                @Html.ValidationMessageFor(c => c.Entity.Name)
                
            </td>
        </tr>
        <tr>
            <td class="td_title">@Html.LabelFor(c => c.Entity.Remark):</td>
            <td>
                @Html.TextAreaFor(c => c.Entity.Remark, 8, 50, new { @class = "easyui-validatebox", @placeholder = "请输入" })
            </td>
        </tr>
        <tr>
            <td class="td_title"></td>
            <td>
                <button type="button" class="easyui-linkbutton" onclick="return Save(@Model.Added);">保存</button>
                <button type="reset" class="easyui-linkbutton">重置</button>
            </td>
        </tr>
    </table>
}
@section scripts{
    <script type="text/javascript">
        function VerifyFrom() {
            var Name = $("#Entity_Name").val();
            if (Name == "")
            {
                $.messager.alert('系统消息', '角色名称不能为空');
                return false;
            }
            $.getJSON("CheckRoleName", { RoleName: Name }, function (data) {
                if (data == false) {
                    return true;
                } else {
                    $.messager.alert('系统消息', '角色名称不能重复');
                    return false;
                }
            });
            return true;
        }
        function Save(added) {
            var flg = VerifyFrom();
            if (flg==true) {
                var ID = $("#Entity_ID").val();
                var Name = $("#Entity_Name").val();
                var Remark = $("#Entity_Remark").val();

                if (added) {
                    $.post("AjaxAdd", { ID: ID, Name: Name, Remark: Remark }, function (data) {
                        $.messager.alert('系统消息', data.Message);
                    }, "json");
                } else {
                    $.post("AjaxEdit", { ID: ID, Name: Name, Remark: Remark }, function (data) {
                        $.messager.alert('系统消息', data.Message);
                    }, "json");
                }
            }
        }
    </script>
}
