@using LCL.MvcExtensions;
@{
    ViewBag.Title = "用户信息";
}
<div class="easyui-layout" data-options="fit:true" id="tb">
    <!-------------------------------搜索框----------------------------------->
    <div data-options="region:'north'" style="padding: 1px; height:70px;">
        <fieldset>
            <legend>信息查询</legend>
            <form id="ffSearch" method="post">
                <div id="toolbar" style="margin-bottom:5px">
                    <label class="sr-only" for="inputfile"> 组织：</label>
                    <select id="cc" class="easyui-combotree"
                            data-options="url:'AjaxEasyUITree_Department'" style="width: 120px; height: 28px;"></select>
                    <label class="sr-only" for="inputfile">搜:</label>
                    <input type="text" name="Keyword" id="Keyword" class="easyui-textbox" style="width: 220px; height: 25px; text-align: center;" placeholder="请输入" />
                    <a id="btnSearch" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search">查询</a>&nbsp;
                    <a id="btnImport" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" onclick="ShowImport()">导入</a>&nbsp;
                    <a id="btnExport" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-excel" onclick="ShowExport()">导出</a>&nbsp;
                </div>
            </form>
        </fieldset>
    </div>
    <!-------------------------------详细信息展示表格----------------------------------->
    <div data-options="region:'center'">
        <table id="grid" style="width: 100%" title="用户管理" toolbar="#tbar" data-options="iconCls:'icon-view'" fit="true"></table>
        <!--   命令列表     -->
        <div id="tbar">
            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="add()">添加</a>&nbsp;
            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-lock" plain="true" onclick="ResetPassword()">初始化密码</a>&nbsp;
            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="del()">删除</a>&nbsp;
            <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-reload" plain="true" onclick="refresh()">刷新</a>&nbsp;
            <a href="javascript:void(0)" />
        </div>
    </div>
    <!--   弹出框       -->
    <div id="dlg" class="easyui-dialog" style="width: 500px; height: 280px; padding: 1px 1px;" closed="true" buttons="#dlg-buttons">

    </div>
</div>
@section scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            $('#grid').datagrid({
                url: 'AjaxGetByPage',
                loadMsg: '数据加载中....',
                title: '用户信息一览表',
                iconCls: 'icon-edit',
                pagination: true,
                rownumbers: true,
                fitCloumns: true,
                hideColumn: [[
                  { title: '编号', field: 'ID' }
                ]],
                columns: [[
                    { field: 'ck', checkbox: true },
                    { field: 'Name', title: '名称', width: 200 },
                    { field: 'Sex', title: '性别', width: 50 },
                    { field: 'Birthday', title: '出生年月', width: 100 },
                    { field: 'IdCard', title: '身份证号', width: 150 },
                    { field: 'Telephone', title: '电话', width: 100 },
                    { field: 'Email', title: '电子邮箱', width: 100 },
                    {
                        field: 'IsLockedOut', title: '是否锁定', align: 'center', width: 80,
                        formatter: function (val, rec) {
                            if (val) {
                                return '<div class="icon-true">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>';
                            } else {
                                return '<div class="icon-false">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>';
                            }
                        }
                    },
                    { field: 'UpdateDate', title: '更新时间', width: 100 },
                    {
                        field: 'opt', title: '操作', width: 100, align: 'center',
                        formatter: function (value, rec) {
                            return " "
                                + "<a href='javascript:void(0)' class='easyui-linkbutton' iconcls='icon-edit' plain='true' onclick='edit()'>修改 </a>  "
                                + "<a href='javascript:void(0)' class='easyui-linkbutton' iconcls='icon-remove' plain='true' onclick='del()'>删除 </a>    ";
                        }
                    }
                ]]
            });

        });
        function add() {
            var d = $('#dlg').dialog({
                title: '添加',
                width: 500,
                height: 280,
                closed: true,
                cache: false,
                href: 'AddOrEdit',
                iconCls: 'icon-add',
                modal: true,
                onClose: function () {
                    refresh();
                }
            });
            $("#dlg").dialog("open");

        }
        function edit() {
            var row = $("#grid").datagrid("getSelected");
            if (row) {
                $('#dlg').dialog({
                    title: '修改',
                    width: 500,
                    height: 280,
                    closed: true,
                    cache: false,
                    href: 'AddOrEdit?id=' + trim(row.ID),
                    iconCls: 'icon-edit',
                    modal: true,
                    onClose: function () {
                        refresh();
                    }
                });
                $("#dlg").dialog("open");
            }
        }
        function del() {
            var rows = $('#grid').datagrid('getSelections');
            if (!rows || rows.length == 0) {
                $.messager.alert('提示', '请选择要删除的数据!', 'info');
                return;
            }
            var parm;
            $.each(rows, function (i, row) {
                if (i == 0) {
                    parm = "idList=" + row.ID;
                } else {
                    parm += "&idList=" + row.ID;
                }
            });
            $.messager.confirm('提示', '是否删除选中数据?', function (r) {
                if (!r) {
                    return;
                }
                //提交
                $.post('AjaxDeleteList/', parm,
                function (msg) {
                    if (msg.Success) {
                        $.messager.alert('提示', msg.Message, 'info', function () {
                            //重新加载当前页
                            $('#grid').datagrid('reload');
                        });
                    } else {
                        $.messager.alert('提示', msg.Message, 'info')
                    }
                }, "json");
            });
        }
        function ResetPassword() {
            var rows = $('#grid').datagrid('getSelections');
            if (!rows || rows.length == 0) {
                $.messager.alert('提示', '请选择要重置的数据!', 'info');
                return;
            }
            var parm;
            $.each(rows, function (i, row) {
                if (i == 0) {
                    parm = "idList=" + row.ID;
                } else {
                    parm += "&idList=" + row.ID;
                }
            });
            $.messager.confirm('提示', '是否重置选中数据?', function (r) {
                if (!r) {
                    return;
                }
                //提交
                $.post('ResetPassword/', parm,
                function (msg) {
                    if (msg.Success) {
                        $.messager.alert('提示', msg.Message, 'info', function () {
                            $('#grid').datagrid('reload');
                        });
                    } else {
                        $.messager.alert('提示', msg.Message, 'info')
                    }
                }, "json");
            });
        }
        function refresh() {
            $('#grid').datagrid('load');
        }
    </script>
}